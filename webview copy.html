<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>主细表式双栏布局</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f9f9f9;
      }
      .container {
        display: flex;
        padding: 20px;
      }
      .main-content {
        flex: 3; /* 主内容占3份 */
        background-color: #fff;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }
      .sidebar {
        flex: 2; /* 辅助内容占1份 */
        margin-left: 20px;
        background-color: #fff;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }
      /* .icon-example:before {
        content: "\eb7e";
      } */
      :root {
        --keybinding-background: rgba(0, 0, 0, 0.08);
        --keybinding-foreground: #005fb8;
      }
      .container1 > div:first-child {
        font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
        padding: 2px 4px;
        color: var(--blue);
        background-color: var(--keybinding-background);
        color: var(--keybinding-foreground);
        display: inline-block;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        -o-border-radius: 4px;
        border-radius: 4px;
        margin-right: 5px;
      }
      .key {
        color: #f9f9f9;
        font-weight: 600;
        background-color: #005fb8;
        padding: 2px 5px;
        border: none; /* 去掉边框 */
        border-radius: 5px; /* 圆角 */
        box-shadow: 4px 4px 6px rgba(0, 0, 0, 0.3); /* 阴影效果 */
      }
      .shortcuts {
        color: black;
        font-weight: 600;
        background: #ffc745;
        padding: 2px 5px;
        border: none; /* 去掉边框 */
        border-radius: 5px; /* 圆角 */
        box-shadow: 4px 4px 6px rgba(0, 0, 0, 0.3); /* 阴影效果 */
      }
      .nonShortscuts {
        background-color: brown;
        font-weight: 600;
        padding: 2px 5px;
        border: none; /* 去掉边框 */
        border-radius: 5px; /* 圆角 */
        box-shadow: 4px 4px 6px rgba(0, 0, 0, 0.3); /* 阴影效果 */
      }
      .container1 {
        display: flex;
        padding: 2px;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="main-content">
        <h2>输入: AA</h2>
        <!-- <h2>主要内容</h2> -->
        <!-- <p>这里是详细的文字内容或表单。</p> -->
        <div id="overlay"></div>
      </div>
      <div class="sidebar">
        <h3>
          <!-- 辅助说明 -->
          <!-- <i
            class="layui-icon"
            style="font-family: 'layui-icon' !important"
            >&#xeb7e;</i
          > -->
        </h3>
        <!-- <p>这里是辅助信息或预览内容。</p> -->
        <div id="bs"></div>
      </div>
    </div>
    <div style="width: max-content">
      &lt;F5&gt;
    </div>
   
    <svg width="30" height="17">
      <rect x="0" y="0" width="100%" height="100%" fill="yellow" stroke="black" stroke-width="1" rx="4" ry="4" />
      <defs>
        <!-- 此处的clipPath区域表示高亮区域，实际应用中可由JS根据搜索结果动态更新 -->
        <clipPath id="highlight-clip">
          <rect x="5" y="2" width="13" height="13"/>
        </clipPath>
      </defs>
      <!-- 底层文本，正常显示 -->
      <text x="5" y="13" font-size="13" fill="black">
        AA
      </text>
      <!-- 叠加的文本，通过clipPath只显示高亮区域 -->
      <text x="5" y="13" font-size="13" fill="red" clip-path="url(#highlight-clip)">
        AA
      </text>
    </svg>

    
  </body>
  <script>
    var idx = 0;
    var canvasArr = [];
    function drawButton(
      text,
      fontSize,
      fontColor,
      radius,
      padding,
      shadow,
      fillStyle,
      strokeStyle
    ) {
      let dpr = window.devicePixelRatio || 1;
      const canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");
      // 先设置正确的字体大小（放大 dpr 倍）
      ctx.font = `bold ${fontSize}px Menlo, Monaco, Consolas, 'Courier New', monospace`;

      // 计算文本宽度
      let textWidth = ctx.measureText(text).width;

      // 计算按钮的尺寸（逻辑像素尺寸）
      let btnWidth = textWidth + padding.paddingX * 2;
      let btnHeight = fontSize + padding.paddingY * 2;

      // **物理像素尺寸（乘 dpr）**
      canvas.width = btnWidth * dpr;
      canvas.height = btnHeight * dpr;

      // **CSS 保持原大小，避免视觉上变大**
      canvas.style.width = `${btnWidth}px`;
      canvas.style.height = `${btnHeight}px`;

      // **缩放上下文，避免绘制内容被放大**
      ctx.scale(dpr, dpr);

      canvasArr[idx] = canvas;
      ctx.shadowColor = shadow.shadowColor;
      ctx.shadowBlur = shadow.blur;
      ctx.shadowOffsetX = shadow.shadowOffsetX;
      ctx.shadowOffsetY = shadow.shadowOffsetY;

      //黄色背景 黑色边框
      ctx.fillStyle = fillStyle;
      ctx.strokeStyle = strokeStyle;

      drawRoundedRect(ctx, 0, 0, btnWidth, btnHeight, radius);

      ctx.shadowColor = "transparent";
      ctx.textAlign = "left";
      ctx.textBaseline = "middle";

      // **计算文本位置**
      var textX = padding.paddingX + 1; // 让文本从左侧 padding 开始
      var textY = btnHeight / 2;

      // **绘制完整文本**
      ctx.fillStyle = fontColor;
      ctx.fillText(text, textX, textY);

      // **测量第一个字母宽度**
      var firstLetter = text.charAt(0);
      var letterWidth = ctx.measureText(firstLetter).width;

      // **计算第一个字母的起始位置**
      var firstLetterX = textX; // 由于 textAlign = "left"，起点就是 `textX`

      // **先清除第一个字母的区域**
      // ctx.fillStyle = "blue"; // 让背景色填充
      // ctx.fillRect(firstLetterX, textY - fontSize / 2, letterWidth, fontSize);

      // **绘制红色高亮的第一个字母**
      ctx.fillStyle = "red";
      ctx.fillText(firstLetter, firstLetterX, textY);
    }
    function drawRoundedRect(ctx, x, y, width, height, radius) {
      ctx.beginPath();
      //上线   从左到右
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      //右上角
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      //右线 从上到下
      ctx.lineTo(x + width, y + height - radius);
      //右下角
      ctx.quadraticCurveTo(
        x + width,
        y + height,
        x + width - radius,
        y + height
      );
      //下线 从右到左
      ctx.lineTo(x + radius, y + height);
      //左下角
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      //左线 从下到上
      ctx.lineTo(x, y + radius);
      //左上角
      ctx.quadraticCurveTo(x, y, x + radius, y);

      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }
  </script>
  <script>
    document.addEventListener("keydown", function (event) {
      if (event.key === " " || event.code === "Space") {
        event.preventDefault(); // 阻止默认行为 [[7]]
        // event.stopPropagation(); // 阻止事件冒泡
        console.log("Space key event blocked.");
      } else {
        console.log(event.code);
      }
    });
  </script>
  <script>
    const vscode = acquireVsCodeApi();
    vscode.postMessage({ type: "requestPathShortcut" });
    window.addEventListener("message", (event) => {
      const type = event.data.type;
      const pathShortcut = event.data.pathShortcut;
      const bs = event.data.bs;
      const overlayElement = document.getElementById("overlay");
      const bsElement = document.getElementById("bs");
      let htmlbs = "";
      let html = "";

      const bodys = [bs, pathShortcut].map((data) => {
        let tmpHtml = "";
        for (const obj of data) {
          tmpHtml += `<div class="container1"><div>${obj.name}</div>`;
          const isNon =
            (obj.shortcuts && obj.shortcuts.startsWith("没有快捷键")) ||
            (obj.key && obj.key.startsWith("没有快捷键"));
          const isAAoCtrlA = obj.key; //
          let sty = isAAoCtrlA ? "key" : "shortcuts";
          sty = isNon ? "nonShortscuts" : sty;
          const shorts = isNon ? "没有快捷键" : obj[sty];

          drawButton(
            shorts,
            13,
            isAAoCtrlA ? "white" : "black",
            5,
            { paddingY: 2, paddingX: 5 },
            {
              shadowColor: "rgba(0,0,0,0.3)",
              blur: 8,
              shadowOffsetX: 3,
              shadowOffsetY: 3
            },
            isAAoCtrlA ? "#005fb8" : "#ffc745",
            "black"
          );
          // tmpHtml += `<div id="ctx${idx}" class=${sty}>${shorts}</div></div>`;
          tmpHtml += `<div id="ctx${idx}"></div></div>`;
          idx++;

          // if (!isAAoCtrlA) {
          //   // const sty = bool ? 'nonShortscuts': "shortcuts";
          //   // const sc = bool ? '没有快捷键': obj.shortcuts;
          //   tmpHtml += `<span class=${sty}>[${sc}]</span> <br/>`;
          // } else {
          //   // const sty = bool ? 'nonShortscuts': "key";
          //   // const sc = bool ? '没有快捷键': obj.key;
          //   tmpHtml += `<span class=${sty}>[${sc}]</span> <br/>`;
          // }
        }
        return tmpHtml;
      });
      // vscode.postMessage({ type: "test", data: pathShortcut, html: bodys });

      bsElement.innerHTML = htmlbs + bodys[0];
      overlayElement.innerHTML = html + bodys[1];
      canvasArr.forEach((cv, idx) => {
        document.getElementById("ctx" + idx).appendChild(cv);
      });
    });
  </script>
</html>
